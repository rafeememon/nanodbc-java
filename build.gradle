apply plugin: 'java'
apply plugin: 'eclipse'

sourceCompatibility = '1.8'
targetCompatibility = '1.8'

repositories {
  mavenCentral()
}

configurations {
  javacpp
}

dependencies {
  javacpp group: 'org.bytedeco', name: 'javacpp', version: javacppVersion

  compile group: 'org.bytedeco', name: 'javacpp', version: javacppVersion
}

jar {
  from sourceSets.main.allSource
}

task compileJavacpp(type: JavaExec) {
  def cp = sourceSets.main.output.getFiles().join(File.pathSeparator)
  def includePathNanodbc = file('.').toString() + '\\nanodbc\\src'
  def includePathNanodbcJava = file('.').toString() + '\\src\\main\\cpp'

  classpath = configurations.javacpp
  main = 'org.bytedeco.javacpp.tools.Builder'
  args = [
    '-cp', cp,
    '-Xcompiler', includePathNanodbc + '\\nanodbc.cpp',
    '-Xcompiler', includePathNanodbcJava + '\\nanodbc_java.cpp',
    '-Xcompiler', 'odbc32.lib',
    '-Xcompiler', 'odbccp32.lib',
    '-Xcompiler', '/I' + includePathNanodbc,
    '-Xcompiler', '/I' + includePathNanodbcJava,
    '-Xcompiler', '/DNANODBC_DISABLE_ASYNC'
  ]
}

compileJavacpp.mustRunAfter compileJava, processResources
classes.dependsOn compileJavacpp
